#!/usr/bin/env ruby

require 'edifact_converter'

$COMMAND_NAME = 'edifact_converter'
options = EdifactConverter::CommandLineParser.parse
#EdifactConverter::Configuration.hide_position = true

def print_errors(errors)
  errors.each do |error|
    $stderr.puts error
  end
end

if options[:source] == :xml
  xmltext = EdifactConverter.read_file(options[:input])
  result = EdifactConverter.convert_xml(xmltext)
  print_errors result.properties[:errors]
  if options[:xml11]
    puts result.ast.document
  else
    puts result.format_edifact  
  end
else
  editxt = EdifactConverter.read_file(options[:input])
  result = EdifactConverter.convert_edifact(editxt)
  result.verify
  print_errors result.properties[:errors]
  if options[:xml11]
    puts result.ast.document
  elsif options[:html]
    puts result.html
  else
    puts result.xml
  end
end

