#!/usr/bin/env ruby

require 'edifact_converter'

$COMMAND_NAME = 'edifact_converter'
options = EdifactConverter::CommandLineParser.parse
#EdifactConverter::Configuration.hide_position = true

def print_errors(errors)
  errors.each do |error|
    $stderr.puts error
  end
end

if options[:source] == :xml
  xmltext = EdifactConverter.read_file(options[:input])
#  result = nil
#  10.times do |number|
    result = EdifactConverter.convert_xml(xmltext)
#    $stderr.puts "Round: #{number}"
#  end
  print_errors result.properties[:errors]
  if options[:xml11]
    puts result.xml11
  else
    puts result.format_edifact  
  end
else
  editxt = EdifactConverter.read_file(options[:input])
  result = EdifactConverter.convert_edifact(editxt)
  print_errors result.properties[:errors]
  puts result.format_edifact  
  if options[:xml11]
    puts result.xml11
  elsif options[:html]
    puts result.html
  else
    puts result.xml
  end
end

